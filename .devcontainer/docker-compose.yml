version: '3'
services:
  api:                 # `devcontainer.json`の'service'と一致させる
    container_name: 'python'  # コンテナ名
    hostname: 'python'        # ホスト名.ゲストOSのシェルに表示されるので指定している

    # 以下は他のリポジトリも全て同じ設定にしています
    build: .                  # Dockerfileがあるディレクトリ
    restart: always           # 常に再起動
    working_dir: '/workspace' # デフォルトの作業ディレクトリ
    tty: true                 # コンテナを終了させずに待たせる
    volumes:                  # ホストとゲストのディレクトリを紐づける
      - type: bind            # ホストのディレクトリをゲストにマウントさせる
        source: ../workspace  # ホストの`workspace`ディレクトリを指定
        target: /workspace    # ゲストの`/workspace`にマウントさせる
  db:
      image: mysql:5.7
      container_name: db
      environment:
        MYSQL_ROOT_PASSWORD: rootpass
        MYSQL_DATABASE: sample_db
        MYSQL_USER: mysqluser
        MYSQL_PASSWORD: mysqlpass
      volumes:
        - ./db/data:/var/lib/mysql
        - ./db/my.cnf:/etc/mysql/conf.d/dbconfig.cnf
        - ./db/initdb.d:/docker-entrypoint-initdb.d
      ports:
        - 3308:3308
      command: --port 3308
      tty: true